---
interface Props {
  year: number;
  month: number;
  diaryDates: string[];
}

const { year, month, diaryDates } = Astro.props;

const monthNames = ['ä¸€æœˆ', 'äºŒæœˆ', 'ä¸‰æœˆ', 'å››æœˆ', 'äº”æœˆ', 'å…­æœˆ', 
                    'ä¸ƒæœˆ', 'å…«æœˆ', 'ä¹æœˆ', 'åæœˆ', 'åä¸€æœˆ', 'åäºŒæœˆ'];

// è·å–å½“æœˆç¬¬ä¸€å¤©æ˜¯æ˜ŸæœŸå‡ å’Œå½“æœˆå¤©æ•°
const firstDay = new Date(year, month, 1).getDay();
const daysInMonth = new Date(year, month + 1, 0).getDate();

// ç”Ÿæˆæ—¥å†æ ¼å­
const calendarDays: (number | null)[] = [];
for (let i = 0; i < firstDay; i++) {
  calendarDays.push(null);
}
for (let i = 1; i <= daysInMonth; i++) {
  calendarDays.push(i);
}

// æ£€æŸ¥æŸå¤©æ˜¯å¦æœ‰æ—¥è®°
function hasDiary(day: number): boolean {
  const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
  return diaryDates.includes(dateStr);
}

const weekDays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
---

<div class="calendar">
  <div class="calendar-header">
    <h3 class="calendar-title">{monthNames[month]} {year}</h3>
  </div>
  
  <div class="calendar-weekdays">
    {weekDays.map(day => (
      <div class="weekday">{day}</div>
    ))}
  </div>
  
  <div class="calendar-grid">
    {calendarDays.map(day => (
      <div class={`calendar-day ${day ? '' : 'empty'} ${day && hasDiary(day) ? 'has-diary' : ''}`}>
        {day && (
          <>
            <span class="day-number">{day}</span>
            {hasDiary(day) && <span class="sun-icon">ğŸŒ»</span>}
          </>
        )}
      </div>
    ))}
  </div>
</div>

<style>
  .calendar {
    background: var(--surface);
    backdrop-filter: blur(22px);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border);
    padding: var(--spacing-lg);
    box-shadow: var(--shadow);
    position: relative;
    overflow: hidden;
  }

  .calendar::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(280px circle at 20% 0%, color-mix(in srgb, var(--primary) 30%, transparent), transparent 65%);
    opacity: 0.6;
    pointer-events: none;
  }

  .calendar-header {
    text-align: center;
    margin-bottom: var(--spacing-md);
    position: relative;
    z-index: 1;
  }

  .calendar-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--primary);
    font-family: var(--font-display);
  }

  .calendar-weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 6px;
    margin-bottom: var(--spacing-sm);
    position: relative;
    z-index: 1;
  }

  .weekday {
    text-align: center;
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--text-muted);
    padding: var(--spacing-xs);
    letter-spacing: 0.12em;
  }

  .calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 6px;
    position: relative;
    z-index: 1;
  }

  .calendar-day {
    aspect-ratio: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    border-radius: var(--radius-sm);
    position: relative;
    transition: all var(--transition-fast);
    border: 1px dashed transparent;
  }

  .calendar-day:not(.empty):hover {
    background: color-mix(in srgb, var(--primary) 18%, transparent);
    border-color: color-mix(in srgb, var(--primary) 35%, transparent);
  }

  .calendar-day.has-diary {
    background: linear-gradient(135deg, color-mix(in srgb, var(--primary) 35%, transparent), rgba(255, 255, 255, 0.9));
    cursor: pointer;
    border-color: color-mix(in srgb, var(--primary) 40%, transparent);
  }

  .calendar-day.has-diary:hover {
    transform: scale(1.04);
  }

  .day-number {
    font-size: 0.9rem;
    font-weight: 600;
  }

  .sun-icon {
    font-size: 0.75rem;
    position: absolute;
    bottom: 3px;
    animation: pulse 2.2s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.8; transform: scale(0.95); }
  }
</style>
